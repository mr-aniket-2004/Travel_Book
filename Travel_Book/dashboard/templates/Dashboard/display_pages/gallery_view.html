{% extends "Dashboard/base_dashboard.html" %}



{% block content %}
<div class="md:w-3/4">
    {% if messages %}
    {% for message in messages %}
    <div class="mb-4 p-3 rounded-lg
        {% if message.tags == 'error' %}
            bg-red-500/20 text-red-400
        {% else %}
            bg-green-500/20 text-green-400
        {% endif %}
    ">
        {{ message }}
    </div>
    {% endfor %}
    {% endif %}

    <h2 class="text-2xl font-bold mb-4 text-white">Gallery</h2>
    <div class="flex item-center gap-5">
        <form action="" method="get">
            {% csrf_token %}
            <div class="w-full max-w-sm flex items-center justify-between gap-5">
                <!-- Label -->
                <label for="categories" class="block mb-1 text-sm font-medium text-white/80">
                    Category
                </label>

                <!-- Select -->
                <select id="categories" name="categories" onchange="this.form.submit()" class="w-full rounded-md bg-white/5 px-3 py-2
               text-white outline-none
               border border-white/10
               focus:ring-2 focus:ring-indigo-500
               focus:border-indigo-500">

                    <option value="" class="bg-slate-800">
                        All
                    </option>
                    {% for list in trip_list %}
                    <option value="{{ list.id }}" class="bg-slate-800" {% if check_id == list.id %} selected {% endif %}>
                        {{ list.title }}
                    </option>

                    {% endfor %}



                </select>


            </div>
        </form>
        <a href="{% url 'gallery' %}" class="px-4 py-2 rounded-md bg-red-500/10 text-red-400
          border border-red-500/20 hover:bg-red-500/20
          transition">
            Clear
        </a>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 my-5">

        {% if gallery_list %}

        {% for item in gallery_list %}
        <div onclick="openCategoryPopup(
             '{{ item.id }}',
    '{{ item.name|escapejs }}',
    '{{ item.description|escapejs }}',
    '{{ item.created_at|timesince }} ago',
    '{{ item.image.url }}'
)" class="group relative cursor-pointer overflow-hidden rounded-xl
               border border-white/10 bg-gray-900 hover:shadow-xl transition">

            <img src="{{ item.image.url }}"
                class="w-full h-48 object-cover group-hover:scale-105 transition duration-300" alt="Gallery Image">

            <!-- Overlay -->
            <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition
                    flex items-end p-4">
                <p class="text-white font-semibold text-sm">
                    {{ item.name }}
                </p>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="w-full max-w-5xl bg-gradient-to-b from-slate-900 to-slate-950
           border border-white/10 rounded-2xl
           flex flex-col items-center justify-center
           px-6 py-12 sm:py-10 text-center shadow-xl">

            <!-- Icon -->
            <div class="mb-6 flex h-14 w-14 items-center justify-center
             rounded-xl border border-white/20 bg-white/5">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-white/70" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                </svg>
            </div>

            <!-- Title -->
            <h2 class="text-lg sm:text-xl font-semibold text-white">
                No Photo Uploaded
            </h2>

            <!-- Subtitle -->
            <p class="mt-2 text-sm sm:text-base text-white/60 max-w-md">
                Get started by Uploading new Photos
            </p>

            <!-- Button -->
            <button class="mt-6 inline-flex items-center gap-2
             rounded-lg bg-indigo-500 px-5 py-2.5
             text-sm sm:text-base font-medium text-white
             hover:bg-indigo-600 transition
             focus:outline-none focus:ring-2 focus:ring-indigo-400">

                <span class="text-lg">+</span>
                <a href="{% url 'upload_photo' %}">Upload</a>
            </button>

        </div>
        {% endif %}


    </div>


    <!-- Popup Modal -->
    <div id="categoryModal" class="fixed inset-0 bg-black/70 hidden flex items-center justify-center z-50">

        <div class="bg-slate-900 rounded-xl w-[90%] max-w-xl relative overflow-hidden">

            <!-- Close -->
            <button onclick="closeCategoryPopup()"
                class="absolute top-3 right-3 text-white/70 hover:text-white text-xl">
                âœ•
            </button>

            <!-- Image -->
            <img id="modalImage" class="w-full h-64 object-cover">

            <!-- Content -->
            <div class="p-5 space-y-3">
                <h2 id="modalTitle" class="text-xl font-bold text-white"></h2>
                <p id="modalDescription" class="text-white/80 text-sm"></p>
                <p id="modalDate" class="text-xs text-white/50"></p>

                <!-- Delete Button -->
                <form id="deleteGalleryForm" method="post"
                    onsubmit="return confirm('Are you sure you want to delete this photo?');">
                    {% csrf_token %}
                    <button type="submit"
                        class="mt-4 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-semibold">
                        ðŸ—‘ Delete Photo
                    </button>
                </form>
            </div>
        </div>
    </div>



    <script>
        function openCategoryPopup(id, name, description, date, imageUrl) {
            document.getElementById("modalTitle").innerText = name;
            document.getElementById("modalDescription").innerText = description;
            document.getElementById("modalDate").innerText = "Uploaded on: " + date;
            document.getElementById("modalImage").src = imageUrl;

            // Set delete form action
            document.getElementById("deleteGalleryForm").action =
                `/dashboard/delete_photo/${id}/`;

            document.getElementById("categoryModal").classList.remove("hidden");
        }

        function closeCategoryPopup() {
            document.getElementById("categoryModal").classList.add("hidden");
        }
    </script>


</div>
{% endblock content %}